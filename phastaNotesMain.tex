\documentclass[12pt, letterpaper, twoside]{article}
\usepackage[margin=2.50cm]{geometry} % Makes the Margins not stupid
\usepackage{bm} % for making bold equation variables
\usepackage{graphicx} % for placing images
\usepackage{float} % for making figure stay in place
\usepackage{amssymb} % for \lessapprox symbol
\usepackage{amsmath} % because using math and \text command in math mode
\usepackage[numbers]{natbib}
\usepackage{cancel} % for doing a diagonal slash cancel
\usepackage[mathscr]{euscript} % for Fancy curly F
\usepackage{cleveref} % for \cref
\usepackage{commath} % for \od, \pd
\usepackage{outlines} % for outlines env

\title{Notes on the Fundamental Equations of PHASTA}
\author{James Wright}
% \date{2019-01-21}

%------------ MACROS ----------------
\newcommand{\etot}{e_{tot}}
\renewcommand{\vec}[1]{\bm{#1}}
\newcommand{\U}{\vec{U}}
\newcommand{\G}{\vec{G}}
\newcommand{\Y}{\vec{Y}}
\newcommand{\F}{\vec{F}}
\newcommand{\W}{\vec{W}}
\newcommand{\x}{\vec{x}}
\newcommand{\NAx}{N_A(\x)}
\newcommand{\NBx}{N_B(\x)}
\newcommand{\NAix}{N_{A,i}(\x)}
\newcommand{\NBix}{N_{B,i}(\x)}
\newcommand{\Neax}{N^e_a(\x)}
\newcommand{\Nebx}{N^e_b(\x)}
\newcommand{\Neaix}{N^e_{a,i}(\x)}
\newcommand{\Nebix}{N^e_{b,i}(\x)}
\newcommand{\sumA}[1]{\sum_{A=1}^{#1}}
\newcommand{\sumB}[1]{\sum_{B=1}^{#1}}
\newcommand{\suma}[1]{\sum_{a=1}^{#1}}
\newcommand{\sumb}[1]{\sum_{b=1}^{#1}}
\newcommand{\src}{\vec{\mathscr{F}}}

\begin{document}
\maketitle

\section{Shorthand}
    \begin{equation}
        \phi_{,t} = \frac{\partial \phi}{\partial t}
    \end{equation}

    \begin{equation}
        \phi_{,i} = \frac{\partial \phi}{\partial x_i}
    \end{equation}

    \begin{equation}
        u_{i,t} = \frac{\partial u_i}{\partial t}
    \end{equation}

    \begin{equation}
        u_{i,j} = \frac{\partial u_i}{\partial x_j}
    \end{equation}

    \begin{equation}
        \left[\phi u_i \right]_{,j} = \frac{\partial \phi u_i}{\partial x_j}
    \end{equation}

\section{Fundamental Fluid Equations}
Unsteady Compressible Navier-Stokes (UCNS) equations:

    \subsection{Traditional Form}
    \paragraph{Continuity}
        \begin{equation}\label{eq:fund_continuity}
            \rho_{,t} + \left[\rho u_j \right]_{,j} = 0
        \end{equation}

    \paragraph{Momentum}
        \begin{equation}\label{eq:fund_momentum}
            \left[\rho u_i \right]_{,t} + \left[\rho u_i u_j \right]_{,j} + p_{,i} = \tau_{ij,j} + b_i
        \end{equation}
        
    \paragraph{Energy}
        \begin{equation}\label{eq:fund_energy}
            \left[\rho \etot \right]_{,t} + 
            \left[\rho \etot u_j \right]_{,j} + \left[\rho u_j \right]_{,j} 
            = \left[\tau_{ij} u_j \right]_{,j} + b_i u_j + r + q_{i,i}
        \end{equation}
    
    \subsection{Conservative Vectorized Form}

    \begin{equation}
        \U \equiv
        \begin{Bmatrix}
            \rho \\
            \rho u_1 \\
            \rho u_2 \\
            \rho u_3 \\
            \rho \etot
        \end{Bmatrix}
        =
        \begin{Bmatrix}
            \rho \\
            \rho u_j \\
            \rho \etot
        \end{Bmatrix}
    \end{equation}

    Flux Vector:

    \begin{equation}
        \begin{split}
        \F_i & = 
        \underbrace{
        \begin{Bmatrix}
            \rho u_i \\
            \rho u_i u_j \\
            \rho u_i \etot
        \end{Bmatrix}
        + \begin{Bmatrix}
            0 \\
            p \delta_{ij}\\
            u_i p
        \end{Bmatrix} }_{\text{Advective Flux}}
        - \underbrace{ \begin{Bmatrix}
            0 \\
            \tau_{ij}\\
            \tau_{ij} u_j 
        \end{Bmatrix}
        + \begin{Bmatrix}
            0 \\
            \vec{0} \\
            q_{i,i}
        \end{Bmatrix} }_{\text{Diffusive Flux}} \\
        & = \F_i^{\text{adv}} + \F_i^{\text{dif}}
        \end{split}
    \end{equation}

    Also:
    \begin{equation}
        \F_i^{adv}  = 
        u_i \U
        + \begin{Bmatrix}
            0 \\
            p \delta_{ij}\\
            u_i p
        \end{Bmatrix} 
    \end{equation}

    Source Vector:

    \begin{equation}
        \src = 
        \begin{Bmatrix}
            0 \\
            b_j \\
            b_j u_j + r
        \end{Bmatrix}
    \end{equation}

    These terms combine together to form:
    \begin{equation} \label{eq:vecNS}
        \U_{,t} + \F_{i,i} = \src
    \end{equation}

\section{Finite Element Discretization}

    Before discritizing, we must first setup the UCNS equations. First, rearrange \cref{eq:vecNS} into a residual form:
    \begin{equation}
        \U_{,t} + \F_{i,i} - \src = \vec{0}
    \end{equation}

    Next multiply by weight/test functions, \(\W\). Note that \(\vec{0}\) is now just a scalar 0.
    \begin{equation}
        \W \cdot ( \U_{,t} + \F_{i,i} - \src )= 0
    \end{equation}

    To create the \textbf{Weak Form} of the NS equations, integrate over the domain \(\Omega\):
    \begin{equation}
        \int_\Omega \W \cdot (\U_{,t} + \F_{i,i} - \src) \dif \Omega= 0
    \end{equation}

    Next, perform integration by parts and Gauss's theorem on \(\F_{i,i}\):
    \begin{equation} \label{eq:weakUCNS_IBP}
        \int_\Omega \left\{\W \cdot \U_{,t} - \W_{,i} \cdot \F_i(\U, \U_{,i}) - \W \cdot \src(\U) \right\} \dif \Omega 
        + \int_\Gamma \W \cdot \F_i(\U, \U_{,i}) \cdot \hat n_i \dif\Gamma= 0
    \end{equation}
    where \(\Gamma\) is the boundary of the domain \(\Omega\) and \(\hat n_i\) is the normal unit vector of the boundary surface. \Cref{eq:weakUCNS_IBP} represents the \textbf{Weak UCNS in IBP Form}. The fact that \(\F_i\) and \(\src\) are functions of \(\U\) and \(\U_{,i}\) is explicitly shown here.

    \subsection{Domain Discretization}
        Define nodes, points, and elements. 

        \subsubsection{Shape Function Decomposition}
        Define a set of functions \(N\) that are a basis for the weight functions. In the case of the \textbf{Galerkin Form}, the basis/shape functions \(N\) are the same for the weight function and the solution function. We can decompose some constant \(\phi\) into

        \begin{equation}
            \phi(\x) = \sum_{A=1}^{n_n} N_A(\x) \phi_A
        \end{equation}

        where \(A\) is the index of each node, \(\phi_A\) is the value of \(\phi\) at each node \(A\), and \(n_n\) is the number of nodes used to discretize \(\Omega\). Note that \(\phi\) on the LHS is continuos, but \(\phi_A\) are discrete scalar values for every \(A\). This decomposition can be extrapolated to our unknowns: \(\U\), \(\U_{,t}\), and \(\W\):

        \begin{subequations}
            \label{eq:variableshapefuncdecomp}
           \begin{align}
                \U(\x) &= \sum_{A=1}^{n_n} N_A(\x) \U_A \\
                \U_{,t}(\x) &= \sum_{A=1}^{n_n} N_A(\x) \U_{A,t} \\
                \W(\x) &= \sum_{B=1}^{n_n} N_B(\x) \W_B 
           \end{align} 
        \end{subequations}

        Since we are working in Galerkin, \(N_A(\x) = N_B(\x) \) for \(A=B\) (ie, at the same node). 

        \subsubsection{Discretize UCNS}
            Let's substitute the expressions in \cref{eq:variableshapefuncdecomp} into the weak UCNS form in \cref{eq:weakUCNS_IBP}.

            \begin{multline}
                \int_\Omega \Biggl\{ \sumB{n_n} \NBx \W_B \cdot \sumA{n_n} \NAx \U_{A,t} 
                - \sumB{n_n} \NBix \W_B \F_i \biggl(\sumA{n_n} \NAx \U_A,\ \sumA{n_n} \NAix \U_A\biggr) \\
                - \sumB{n_n} \W_B \src\biggl(\sumA{n_n} \NAx \U_A \biggr) \Biggr\} \dif \Omega \\
                + \int_\Gamma \sumB{n_n} \W_B \cdot \F_i\biggl(\sumA{n_n} \NAx \U_A,\ \sumA{n_n} \NAix \U_A\biggr) \hat n_i \dif \Gamma = 0
            \end{multline}

            Note that \(\U_{,i} = [\sumA{n_n} \NAx \U_A]_{,i}\) , but since \(\U_A\) is not a function of \(\x\) (it is only dependent on \(A\)), the sum and \(\U_A\) can be taken out of the brakets, leaving \(\NAx\) to be derived: \(\U_{,i} = \sumA{n_n} \NAix \U_A\).

            Since \(\W_B\) is a vector of constants, we can take it out of the integral, along with it's respective summation:
            \begin{multline} \label{eq:shapefuncUCNS}
                \sumB{n_n} \W_B  \Biggl\{\int_\Omega \biggl\{  \NBx  \cdot \sumA{n_n} \NAx \U_{A,t} 
                -  \NBix  \F_i \biggl(\sumA{n_n} \NAx \U_A,\ \sumA{n_n} \NAix \U_A\biggr) \\
                -   \src\biggl(\sumA{n_n} \NAx \U_A \biggr) \biggr\} \dif \Omega \\
                + \int_\Gamma \F_i\biggl(\sumA{n_n} \NAx \U_A,\ \sumA{n_n} \NAix \U_A\biggr) \hat n_i \dif \Gamma \Biggr\} = 0
            \end{multline}

            \begin{equation}
                \cref{eq:shapefuncUCNS} \Rightarrow \sumB{n_n} \W_B \cdot \G_B = 0
            \end{equation}

            If we assume that \(\W_B\) is arbitrary, then \(\G_B=0\).

        \subsubsection{Local/Element level Formulation}
            For brevity, we will abreviate the inputs of \(\F_i\) and \(\src\) to their continous inputs: \(\F_i(\U, \U_i)\) and \(\src(\U)\).

            \begin{multline} 
                \G_b^e = \int_{\Omega^e} \Biggl\{ \Nebx \biggl[ \suma{n_{en}} \Neax \U_{a,t}^e - \src(\U) \biggr] - \Nebix \F_i(\U_a^e, \U_{a,i}^e) \Biggr\} \dif \Omega^e \\
                + \int_{\Gamma^e} \Nebx \F_i(\U_a^e, \U_{a,i}^e) \hat n_i \dif \Gamma^e
            \end{multline}

            Notes:
            \begin{outline}[enumerate]
                \1 \(n_{en}\) is the number of nodes per element
                \1 \(^e\) is the element ID number (\(e = \{1 ... n_n\}\)), 
                \1 \(_a\) is the node ID number relative to the current element, \(a = \{1 ... n_{en}\}\)
                \1 \(\U = \suma{n_{en}} \Neax \U_a^e\) , \(\U_i = \suma{n_{en}} \Neaix \U_a^e\)
                \1 \(\Gamma^e \subset \Gamma \). In words, \(\Gamma^e\) is not the boundary of \(\Omega^e\)
                
            \end{outline}



\end{document}